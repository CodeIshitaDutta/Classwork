---
title: "STA 141A: Assignment 2"
author: "Ishita Dutta, 918193342"
output: html_document
---
***

**Instructions** You may adapt the code in the course materials or any sources (e.g., the Internet, classmates, friends). In fact, you can craft solutions for almost all questions from the course materials with minor modifications. However, you need to write up your own solutions and acknowledge all sources that you have cited in the Acknowledgement section. 

Failing to acknowledge any non-original efforts will be counted as plagiarism. This incidence will be reported to the Student Judicial Affairs. 

*** 


```{r setup, include=FALSE}
knitr::opts_chunk$set(eval = TRUE, echo = TRUE, fig.align='center')
library(tidyverse)

```


(1) Pick a data set that you find interesting. This data set should contain at least four variables. Briefly explain the data set (background, source, variables, samples, etc.), and why it interests you. 

__Answer:__

The dataset I picked is the `quakes` dataset already built into R. This dataset is a record of details about 1000 siesmic events from an area near Fiji since 1964. It is a part of an archive from Harvard and contains 5 variables. These, in order are latitude, longitude, depth of activity under sea level, magnitude, and the number of stations that reported this activity. This interested me because I have learned about tectonic plates and trenches in various earth science classes and I wanted to find a correlation in the depth and the magnitude of the seismic activities. Below are a few observations of the data:
```{r}
head(quakes)
```


*** 


(2) For Questions 2 to 8, we visit `flights` and `weather` in the `nycflights13` dataset. 
  (i) How many observations and variables are there in the `flights` dataset? 
  (ii) Find out the meanings of `talinum`, `flight`, `carrier`, `dep_delay` and `arr_delay` in the `flights` dataset. 
  (iii) Find out the meanings of `visib`,`time_hour`, and `temp` in the `weather` data set. 
  
__Answer:__
```{r, echo=FALSE}
cat("i)\n")
library(nycflights13)
flight <- nycflights13::flights
cat("The number of observations in the flights data set is:",nrow(flight))
cat("\nThe number of observations in the flights data set are:\n")
colnames(flight)
cat("\nii)
found using the `help()` function in R
`talinum` --> tail number for the plane
`flight` --> flight number of a particular flight
`carrier` --> 2 letter carrier abbreviation for each airline
`dep_delay`, `arr_delay` --> delay in departure and arrival, respectively, in minutes. Negative values show early departure or arrival.

iii)
found using the `help()` function in R
`visib` --> visibility in miles
`time_hour` --> Date and hour from record
`temp` --> temperature in F
")
```

***

(3) Extract the entries for _Alaska Airlines_ from the `flights` dataset using `filter()` and `%>%`. Name the selected subset as `alaska_flights`.
Furthermore, extract the weather data for EWR airport in January using `filter` and `%>%`, and name it as `early_january_weather` from `weather`.
```{r, echo = TRUE}
alaska_flights <- flight %>% filter(carrier == "AS")
early_january_weather <- weather %>% filter(origin == "EWR", month == "1")
```

***

(4) Create a scatterplot of `dep_delay` and `arr_delay` in the `alaska_flights` data without using transparency. What do you find about the relationship between these two variable? What are some practical reasons for this relationship?
```{r, echo = FALSE}
library(ggplot2)
ggplot(alaska_flights, aes(x = dep_delay, y = arr_delay))  + geom_point() + ggtitle("Departure vs Arrival Delay in Minutes") + xlab("Departure Delay(min)") + ylab("Arrival Delay(min)")

cat("I can see a general positive correlation in between the departure and arrival delays. In simpler terms, it means that a more delayed departure means a more delayed arrival. The most practical reason is the general time that the flight would take and how a delay in time adds to that...")
```


***

(5) Re-draw the plot in Part 4 with transparency set to be 0.2. Compare the two plot and explain your findings, if any. 
```{r, echo = FALSE}
ggplot(alaska_flights, aes(x = dep_delay, y = arr_delay))  + geom_point(alpha = 0.2) + ggtitle("Departure vs Arrival Delay in Minutes") + xlab("Departure Delay(min)") + ylab("Arrival Delay(min)")

cat("The general findings are still the same, but we do not see this pattern as much if the flight departs early. This means that even if the flight departs early, it will probably still land on time.")
```

***

(6) For the `early_january_weather` data, create a linegraph with `time_hour` on the `x`-axis and `temp` on the `y`-axis.  What do you find from the plot?
```{r, echo=FALSE}
ggplot(data=early_january_weather, aes(x=time_hour, y=temp)) +
  geom_line()

cat("The temperature has waves for different times of the same day, being colder at night than day. I can also see that the week for Jan 21 to Jan 28 was much colder than the other weeks even during the day.")
```

***


(7) Generate data from the following model.
$$y_i = x_i\beta_1 + z_i\beta_2+x_i z_i \beta_3+ \epsilon_i, i = 1,\ldots, 100$$
where $\beta_1=1$, $\beta_2=2$, $\beta_3 =1$, and $\epsilon_i \sim \mathcal{N}(0,1)$. For $x_i$ and $z_i$, generate them as 
$$ x_i \sim\  {\rm uniform} \ (-2,2) \ {\rm and}\  z_i =\tilde{\epsilon}_i,$$
where  $\tilde{\epsilon}_i\sim \mathcal{N}(0,0.5)$.  Fit a linear regression with $y$ as the outcome and $x$ as the covariate (i.e., without $z$) using `lm()`. Report the estimated coefficients. 

```{r, echo = FALSE}

set.seed(50)
regression <- function(i) {
  xvec = vector()
  zvec = vector()
  evec = vector()
  yvec = vector()
  B1 = 1
  B2 = 2
  B3 = 1
  m = 1:i
  for(val in m){
    x = runif(1, min = -2, max = 2)
    xvec = c(xvec, x)
    e = rnorm(1, mean = 0, sd = 1)
    evec = c(evec, e)
    z = rnorm(1, mean = 0, sd = 0.5)
    zvec = c(zvec, z)
    y = (x*B1)+(z*B2)+(x*z*B3)+(e)
    yvec = c(yvec, y)
  }
  retval = data.frame(m, yvec, xvec, zvec, evec)
  return(retval)
}
model = regression(100)
head(model)
lm(yvec~xvec, model)
```

***

(8) Wrap the code in Part 7 into a function, and run a simulation of 5000 instances to obtain the estimated coefficients. Draw a histogram of the estimated coefficients $\hat{\beta}_1$s of $x$ from your simulation, add a vertical line (solid, black) to represent the simulation mean, and add another vertical line (dashed, red) to represent the true value (i.e., 1). Report your findings (hint: you may want to review unbiasedness). 
```{r, echo = FALSE}
model2 = regression(5000)
tail(model2)
lm(yvec~xvec, model2)
ggplot(data=model2, aes(x=xvec)) + geom_histogram(bins = 26, color = "black", fill = "white") + geom_vline(aes(xintercept=mean(xvec)),color="black", linetype="solid", size=0.5) + geom_vline(aes(xintercept=0),color="maroon", linetype="dashed", size=0.5)
cat("The simulation mean is very close but still not the same as the true mean. The high sample size makes the two very close however.")
```

***

(9) Report the simulation mean from Part 8. Then run another simulation under the same setting to verify that your simulation is reproducible. Specifically, the new simulation mean should be identical to the mean from Part 8.
```{r, echo=FALSE}
round(mean(model2$xvec), 3)
model3 = regression(5000)
round(mean(model3$xvec), 3)
```


***

(10)  Generate data from a similar model, with $\gamma_1=0$.  
$$y_i = x_i\beta_1 + z_i\beta_2+\epsilon_i, i = 1,\ldots, 100$$
where $\beta_1=1$, $\beta_2=2$, and $\epsilon_i \sim \mathcal{N}(0,1)$. For $x_i$ and $z_i$, generate them as 
$$ z_i \sim\  {\rm uniform} \ (-2,2) \ {\rm and}\  x_i = z_i \gamma_1 + \gamma_0+\tilde{\epsilon}_i,$$
where $\gamma_1=0$, $\gamma_0=1$, and $\tilde{\epsilon}_i\sim \mathcal{N}(0,0.5)$.  Suppose we fit a regression model with $y$ as the outcome and $x$ as the covariate (i.e., without $z$). Examine whether, in this model, the estimator for the coefficient of $x$ is unbiased using simulation.  

```{r, echo = FALSE}
regression2 <- function(i) {
  xvec = vector()
  zvec = vector()
  evec = vector()
  ehatvec = vector()
  yvec = vector()
  B1 = 1
  B2 = 2
  y0 = 1
  y1 = 0
  m = 1:i
  for(val in m){
    z = runif(1, min = -2, max = 2)
    ehat = rnorm(1, mean = 0, sd = 0.5)
    ehatvec = c(ehatvec, ehat)
    zvec = c(zvec, z)
    x = (z*y1)+(y0)+(ehat)
    xvec = c(xvec, x)
    e = rnorm(1, mean = 0, sd = 1)
    evec = c(evec, e)
    y = (x*B1)+(z*B2)+(e)
    yvec = c(yvec, y)
  }
  retval = data.frame(m, yvec, xvec, zvec, evec, ehatvec)
  return(retval)
}
model4 = regression2(100)
lm(yvec~xvec, data = model4)
```

***

## Acknowledgement {-}

## Session information {-}
```{r}
sessionInfo()
```
